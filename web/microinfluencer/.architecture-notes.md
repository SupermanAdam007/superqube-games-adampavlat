# Architecture Notes

## âš ï¸ IMPORTANT: Firebase Admin SDK Usage

### âœ… CORRECT - Client Side Only Uses:
- `firebase/app` - Initialize app
- `firebase/auth` - User authentication
- `firebase/firestore` - Database queries
- `firebase/storage` - File uploads (coming)

### âŒ NEVER on Client:
- `firebase-admin` package
- `microinfluencers-firestore.json` file
- Admin SDK credentials

### âœ… Server Side Only (API Routes):
Future API routes will use Admin SDK:
- `/api/generate-image` - Image generation + storage
- `/api/generate-caption` - Caption generation
- `/api/admin/*` - Admin operations

## ğŸ—‚ï¸ Storage Structure

**Bucket**: `gs://microinfluencers-1ba2b.firebasestorage.app`

```
/influencer-photos/{userId}/
  - original-1.jpg
  - original-2.jpg

/generated-content/{contentId}/
  - generated-image.jpg
  - thumbnail.jpg

/products/{productId}/
  - product-1.jpg
  - product-2.jpg
```

## ğŸ” Current Security

âœ… **Implemented:**
- Client uses Firebase client SDK only
- No admin credentials exposed
- Protected routes (auth required)
- Firestore security rules
- Role-based access (influencer/agency)

âœ… **File Safety:**
- `microinfluencers-firestore.json` in `.gitignore`
- `.env.local` in `.gitignore`
- Never imported in client components

## ğŸ“ When to Use Admin SDK

Create API route when you need to:
- Bypass Firestore security rules
- Perform privileged operations
- Call external APIs with secrets
- Generate signed URLs
- Batch operations

Example API route structure:
```typescript
// app/api/example/route.ts
import * as admin from 'firebase-admin';
import serviceAccount from '@/microinfluencers-firestore.json';

if (!admin.apps.length) {
  admin.initializeApp({
    credential: admin.credential.cert(serviceAccount)
  });
}

export async function POST(request: Request) {
  // Admin operations here
}
```

